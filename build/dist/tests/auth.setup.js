import { test as setup } from '@playwright/test';
import * as process from 'process';
setup('authenticate', async ({ playwright, request }) => {
    let env = JSON.parse(process.env.ENV_VAR_JSON);
    console.log('Using Environment:', '\x1b[32m' + env.CRM_URL + '\x1b[0m');
    const userAuthFile = 'playwright/.auth/user.json';
    const browser = await playwright.chromium.launch();
    const context = await browser.newContext({ storageState: userAuthFile });
    const page = await context.newPage();
    await page.goto(env.CRM_URL);
    let url = page.url();
    if (url.includes('login.microsoftonline.com')) {
        await page.getByRole('textbox').type(env.USER_NAME);
        await page.getByRole('button', { name: 'Next' }).click();
        await page.getByPlaceholder('Password').type(env.USER_PASSWORD);
        await page.getByRole('button', { name: 'Sign in' }).click();
        await page.getByRole('button', { name: 'Yes' }).click();
    }
    await page.context().storageState({ path: userAuthFile });
    await context.close();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5zZXR1cC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3RzL2F1dGguc2V0dXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksSUFBSSxLQUFLLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEtBQUssT0FBTyxNQUFNLFNBQVMsQ0FBQztBQUVuQyxLQUFLLENBQUMsY0FBYyxFQUFFLEtBQUssRUFBRSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFO0lBQ3BELElBQUksR0FBRyxHQUFjLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUMxRCxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLFVBQVUsR0FBRyxHQUFHLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyxDQUFDO0lBQ3hFLE1BQU0sWUFBWSxHQUFHLDRCQUE0QixDQUFDO0lBQ2xELE1BQU0sT0FBTyxHQUFHLE1BQU0sVUFBVSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUVuRCxNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUN6RSxNQUFNLElBQUksR0FBRyxNQUFNLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNyQyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzdCLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNyQixJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsMkJBQTJCLENBQUMsRUFBRTtRQUMzQyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNwRCxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDekQsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNoRSxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDNUQsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO0tBQzNEO0lBQ0QsTUFBTSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDMUQsTUFBTSxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDMUIsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0ZXN0IGFzIHNldHVwIH0gZnJvbSAnQHBsYXl3cmlnaHQvdGVzdCc7XHJcbmltcG9ydCAqIGFzIHByb2Nlc3MgZnJvbSAncHJvY2Vzcyc7XHJcblxyXG5zZXR1cCgnYXV0aGVudGljYXRlJywgYXN5bmMgKHsgcGxheXdyaWdodCwgcmVxdWVzdCB9KSA9PiB7XHJcbiAgICBsZXQgZW52OiBDUk1Db25maWcgPSBKU09OLnBhcnNlKHByb2Nlc3MuZW52LkVOVl9WQVJfSlNPTik7XHJcbiAgICBjb25zb2xlLmxvZygnVXNpbmcgRW52aXJvbm1lbnQ6JywgJ1xceDFiWzMybScgKyBlbnYuQ1JNX1VSTCArICdcXHgxYlswbScpO1xyXG4gICAgY29uc3QgdXNlckF1dGhGaWxlID0gJ3BsYXl3cmlnaHQvLmF1dGgvdXNlci5qc29uJztcclxuICAgIGNvbnN0IGJyb3dzZXIgPSBhd2FpdCBwbGF5d3JpZ2h0LmNocm9taXVtLmxhdW5jaCgpO1xyXG5cclxuICAgIGNvbnN0IGNvbnRleHQgPSBhd2FpdCBicm93c2VyLm5ld0NvbnRleHQoeyBzdG9yYWdlU3RhdGU6IHVzZXJBdXRoRmlsZSB9KTtcclxuICAgIGNvbnN0IHBhZ2UgPSBhd2FpdCBjb250ZXh0Lm5ld1BhZ2UoKTtcclxuICAgIGF3YWl0IHBhZ2UuZ290byhlbnYuQ1JNX1VSTCk7XHJcbiAgICBsZXQgdXJsID0gcGFnZS51cmwoKTtcclxuICAgIGlmICh1cmwuaW5jbHVkZXMoJ2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20nKSkge1xyXG4gICAgICAgIGF3YWl0IHBhZ2UuZ2V0QnlSb2xlKCd0ZXh0Ym94JykudHlwZShlbnYuVVNFUl9OQU1FKTtcclxuICAgICAgICBhd2FpdCBwYWdlLmdldEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAnTmV4dCcgfSkuY2xpY2soKTtcclxuICAgICAgICBhd2FpdCBwYWdlLmdldEJ5UGxhY2Vob2xkZXIoJ1Bhc3N3b3JkJykudHlwZShlbnYuVVNFUl9QQVNTV09SRCk7XHJcbiAgICAgICAgYXdhaXQgcGFnZS5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogJ1NpZ24gaW4nIH0pLmNsaWNrKCk7XHJcbiAgICAgICAgYXdhaXQgcGFnZS5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogJ1llcycgfSkuY2xpY2soKTtcclxuICAgIH1cclxuICAgIGF3YWl0IHBhZ2UuY29udGV4dCgpLnN0b3JhZ2VTdGF0ZSh7IHBhdGg6IHVzZXJBdXRoRmlsZSB9KTtcclxuICAgIGF3YWl0IGNvbnRleHQuY2xvc2UoKTtcclxufSk7XHJcbmV4cG9ydCBpbnRlcmZhY2UgQ1JNQ29uZmlnIHtcclxuICAgIENSTV9VUkw6IHN0cmluZztcclxuICAgIFVTRVJfTkFNRTogc3RyaW5nO1xyXG4gICAgVVNFUl9QQVNTV09SRDogc3RyaW5nO1xyXG4gICAgQ09OVEFDVF9SRUNPUkRfVVJMOiBzdHJpbmc7XHJcbn0iXX0=